#ifndef TELEPORTER_H
#define TELEPORTER_H

#include "../player.h"
#include "../asset_holder.h"
#include "Obstacle.h"

class teleporter : public Obstacle
{
private:
	////////////////////////////////////////////////////////////
	/// \brief size of teleporter
	///
	////////////////////////////////////////////////////////////
	float BASE_SIZE;

	////////////////////////////////////////////////////////////
	/// \brief timer for animation
	///
	////////////////////////////////////////////////////////////
	float timer;

	////////////////////////////////////////////////////////////
	/// \brief player reference to player object for which
	/// teleporter works 
	///
	////////////////////////////////////////////////////////////
	player& player_var;

	////////////////////////////////////////////////////////////
	/// \brief asset holder from which textures and files used
	///
	////////////////////////////////////////////////////////////
	asset_holder& m_assets;

	////////////////////////////////////////////////////////////
	/// \brief initializes variables
	///
	////////////////////////////////////////////////////////////
	void init_variables();

	////////////////////////////////////////////////////////////
	/// \brief deals with animations
	///
	////////////////////////////////////////////////////////////
	void anim(float dt);

	////////////////////////////////////////////////////////////
	/// \brief sprites and "active" bools for the two portals 
	///
	////////////////////////////////////////////////////////////
	std::pair< sf::Sprite, bool > portals[2];

	////////////////////////////////////////////////////////////
	/// \brief current frame of spritesheet
	///
	////////////////////////////////////////////////////////////
	sf::IntRect currentframe;

	////////////////////////////////////////////////////////////
	/// \brief points which act as triggers for teleportation
	///
	////////////////////////////////////////////////////////////
	sf::Vector2f triggerpoints[2];
public:
	////////////////////////////////////////////////////////////
	/// \brief constructor
	///
	/// \param _portal1 sf::Vector2u position of first portal in player-size units
	/// \param _portal2 sf::Vector2u position of second portal in player-size units
	/// \param _player_var  player& reference to player object to be teleported
	/// \param asset_source asset_holder* pointer to asset class to be used
	///
	////////////////////////////////////////////////////////////
	teleporter(sf::Vector2u portal1, sf::Vector2u portal2, player& _player_var,asset_holder* _assets);

	////////////////////////////////////////////////////////////
	/// \brief destructor
	///
	////////////////////////////////////////////////////////////
	~teleporter();

	////////////////////////////////////////////////////////////
	/// \brief generic update function
	///
	/// serves as container for all other update function/calls
	///
	/// \param _dt float delta time value for which frame rate is adjusted
	///
	////////////////////////////////////////////////////////////
	void update(float _dt);

	////////////////////////////////////////////////////////////
	/// \brief generic render function
	///
	/// serves as container for all other render functions/calls.
	///
	/// \param target sf::RenderTarget* pointer to window in 
	/// which object is to be rendered
	///
	////////////////////////////////////////////////////////////
	void render(sf::RenderTarget* target);

	////////////////////////////////////////////////////////////
	/// \brief implementation of pure virtual function of parent class
	///
	/// \param sf::FloatRect& any floatrect
	/// 
	/// this function is a pure virtual from parent class which
	/// is given the simple implementation of always returning false
	/// as teleporter class can not kill the player
	/// 
	/// \return always return false
	///
	////////////////////////////////////////////////////////////
	const bool isCollide(const sf::FloatRect &shape);

	///////////////////////////////////////////////////
	///	
	///	\brief read the details of teleporter from the file
	///	
	///	\param fin std::ifstream& file stream
	///	\param data Data& file stream \file Data.h
	///	\param size size_t& file no of inputs to be taken
	///	
	///	
	///////////////////////////////////////////////////
	static void read(std::ifstream &fin, Data &data, size_t &size);

};

////////////////////////////////////////////////////////////
/// 
/// \class teleporter
///
/// \brief class for the teleporter obstacle
///
/// this class creates a teleporter object pair which manipulates
/// movement of player given in constructor by changing its
/// position by teleportation upon collision.this class is 
/// a friend of player
///
////////////////////////////////////////////////////////////
#endif